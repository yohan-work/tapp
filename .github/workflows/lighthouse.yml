name: Lighthouse PWA Report

on:
  # ìˆ˜ë™ ì‹¤í–‰ (URL ìž…ë ¥ ë°›ê¸°)
  workflow_dispatch:
    inputs:
      url:
        description: 'PWAë¡œ ë¶„ì„í•  ì›¹ì‚¬ì´íŠ¸ URL'
        required: true
        default: 'https://example.com'
      app_name:
        description: 'ì•± ì´ë¦„'
        required: false
        default: 'My PWA'

jobs:
  lighthouse:
    runs-on: ubuntu-latest
    
    steps:
      - name: ì²´í¬ì•„ì›ƒ
        uses: actions/checkout@v4
      
      - name: Node.js ì„¤ì •
        uses: actions/setup-node@v4
        with:
          node-version: '20'
      
      - name: pnpm ì„¤ì¹˜
        uses: pnpm/action-setup@v2
        with:
          version: 8
      
      - name: ì˜ì¡´ì„± ì„¤ì¹˜
        run: pnpm install
      
      - name: í”„ë¡œì íŠ¸ ë¹Œë“œ
        run: pnpm build
      
      - name: Lighthouse ë¦¬í¬íŠ¸ ìƒì„±
        run: |
          node dist/lighthouse/run-lh.js "${{ github.event.inputs.url }}" "./lighthouse-output"
        continue-on-error: true
      
      - name: ë¦¬í¬íŠ¸ ì•„í‹°íŒ©íŠ¸ ì—…ë¡œë“œ
        uses: actions/upload-artifact@v4
        if: always()
        with:
          name: lighthouse-report-${{ github.run_number }}
          path: |
            lighthouse-output/report.html
            lighthouse-output/report.json
            lighthouse-output/checklist.md
          retention-days: 30
      
      - name: ê²°ê³¼ ìš”ì•½ ì¶œë ¥
        if: always()
        run: |
          echo "### ðŸ” Lighthouse PWA ë¦¬í¬íŠ¸ ìƒì„± ì™„ë£Œ" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "**ë¶„ì„ ëŒ€ìƒ:** ${{ github.event.inputs.url }}" >> $GITHUB_STEP_SUMMARY
          echo "**ì•± ì´ë¦„:** ${{ github.event.inputs.app_name }}" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "ë¦¬í¬íŠ¸ëŠ” ì•„í‹°íŒ©íŠ¸ ì„¹ì…˜ì—ì„œ ë‹¤ìš´ë¡œë“œí•  ìˆ˜ ìžˆìŠµë‹ˆë‹¤." >> $GITHUB_STEP_SUMMARY
          
          # checklist.mdê°€ ìžˆìœ¼ë©´ ë‚´ìš© ì¶œë ¥
          if [ -f lighthouse-output/checklist.md ]; then
            echo "" >> $GITHUB_STEP_SUMMARY
            cat lighthouse-output/checklist.md >> $GITHUB_STEP_SUMMARY
          fi

